<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        const Pending = 'pending'
        const Fulfilled = 'fulfilled'
        const Rejected = 'Rejected'

        class FakePromise {
            
            status = Pending;
            value = null;
            reason = null;
            // 数组的回调
            onFulfilledCallback = [];
            onRejectedCallback = [];

            constructor(executor) {
                executor(this.resolve, this.rejected);
            }

            resolve = (value) => {
                if (this.status === Pending) {
                    this.value = value;
                    this.status = Fulfilled;
                    while(this.onFulfilledCallback.length) {
                        this.onFulfilledCallback.shift()(this.value);
                    }
                }
            }

            rejected = (reason) => {
                if (this.status === Pending) {
                    this.value = reason;
                    this.status = Rejected;
                    while(this.onRejectedCallback.length) {
                        this.onRejectedCallback.shift()(this.reason)
                    }
                }
            }

            then(onFulFilled, onRejected) {
                if (this.status === Fulfilled) {
                    onFulFilled(this.value);
                } else if (this.status === Rejected) {
                    onRejected(this.reason);
                } else if (this.status === Pending) {
                    this.onFulfilledCallback.push(onFulFilled);
                    this.onRejectedCallback.push(onRejected);
                }
            }
        }

        var p = new FakePromise(function (resolve, reject) {
            queueMicrotask(function () {
                resolve('1')
            })
        })

        p.then(res => {
            console.log(1, res)
        })

        p.then(res => {
            console.log(2, res)
        })

        p.then(res => {
            console.log(3, res)
        })
    </script>
</body>
</html>